<% content_for :page_title do %>
  <header class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar justify-content-center">
    <% if @stock.logo.present? %>
      <img src="<%= @stock.logo %>" alt="<%= @stock.symbol %> Logo" style="max-height: 40px; max-width: 80px; margin-right: 10px; margin-top: -5px;"/>
    <% end %>
    <h1 class="bd-title"><%= @page_title %></h1>
  </header>
<% end %>

<div class="row">
  <div class="col-sm-8">

    <%= render partial: 'tradingview_chart' %>

    <h2 style="margin-top: 15px;"><%= number_to_currency(@stock.current_price) %> <small class="<%= delta_class(@stock.price_change) %>"><%= number_to_currency(@stock.price_change) %> (<%= number_to_percentage(@stock.price_change_pct, precision: 2) %>)</small></h2>

    <table class="table table-sm" style="margin-top: 15px;">
      <tr>
        <td style="border-top: none;">
          Previous Close: <strong class="float-right"><%= number_to_currency(@stock.prev_close_price) %></strong>
        </td>
        <td style="width: 20px; border-top: none;"></td>
        <td style="border-top: none;">
          EPS (TTM): <strong class="float-right"><%= number_with_precision(@stock.eps_ttm, precision: 2) %></strong>
        </td>
      </tr>
      <tr>
        <td>
          Open: <strong class="float-right"><%= number_to_currency(@stock.open_price) %></strong>
        </td>
        <td></td>
        <td>
          EPS Growth 5Y: <strong class="float-right"><%= number_to_percentage(@stock.eps_growth_5y, precision: 2) %></strong>
        </td>
      </tr>
      <tr>
        <td>
          Day's Range: <strong class="float-right"><%= number_to_currency(@stock.day_low_price) %> - <%= number_to_currency(@stock.day_high_price) %></strong>
        </td>
        <td></td>
        <td>
          Forward Dividend & Yield: <strong class="float-right">
            <% if @stock.est_annual_dividend %>
              <%= number_to_currency(@stock.est_annual_dividend) %> (<%= number_to_percentage(@stock.est_annual_dividend_pct, precision: 2) %>)
            <% end %>
          </strong>
        </td>
      </tr>
      <tr>
        <td>
          52 Week Range: <strong class="float-right">
            <% if @stock.week_52_low && @stock.week_52_high %>
              <%= number_to_currency(@stock.week_52_low) %> - <%= number_to_currency(@stock.week_52_high) %>
            <% end %>
          </strong>
        </td>
        <td></td>
        <td>
          Dividend Growth 5Y: <strong class="float-right"><%= number_to_percentage(@stock.dividend_growth_5y, precision: 2) %></strong>
        </td>
      </tr>
      <tr>
        <td>
          PE Ratio (TTM): <strong class="float-right"><%= number_with_precision(@stock.pe_ratio_ttm, precision: 2) %></strong>
        </td>
        <td></td>
        <td>
          Payout: <strong class="float-right"><%= number_to_percentage(@stock.payout_ratio, precision: 2) %></strong>
        </td>
      </tr>
    </table>

    <%# if @stock.logo.present? %>
    <!--img src="<%= @stock.logo %>" alt="<%= @stock.symbol %> Logo"/-->
  <%# end %>
  <p>
  <% @stock.tags.by_key(:company_tag).each do |tag| %>
    <span class="badge badge-pill badge-secondary"><%= tag %></span>
  <% end %>
  </p>

  <h3>About</h3>
  <p>
    <%= @stock.description %>
  </p>
  <p>
    <strong>Exchange:</strong>
    <%= @stock.exchange %>
  </p>
  <p>
    <strong>CEO:</strong>
    <%= @stock.ceo %>
  </p>
  <p>
    <strong>Headquarters:</strong>
    <%= "#{@stock.country}, #{@stock.state}" %>
  </p>
  <p>
    <strong>Employees:</strong>
    <%= number_with_delimiter(@stock.employees, delimiter: ',') %>
  </p>
  <p>
    <strong>Website:</strong>
    <%= link_to_website @stock.website %>
  </p>

<p>
  <strong>Peers:</strong>
<% stock_peers.each do |stock_peer| %>
  <% if stock_peer[:stock] %>
      <%= link_to stock_peer[:symbol], stock_path(stock_peer[:stock]), class: 'badge badge-pill badge-info' %>
  <% else %>
    <span class="badge badge-pill badge-secondary"><%= stock_peer[:symbol] %></span>
  <% end %>
<% end %>
</p>

<div>
  <%= link_to 'Back', back_url, class: 'btn btn-link' %>
  <% if @stock.destroyable? %>
    <%= link_to 'Delete', stock_path(@stock), method: :delete, class: 'btn btn-danger', data: {confirm: "Are you sure you want to delete #{@stock.to_s}?"} %>
  <% end %>
</div>

  </div>
  <div class="col-sm-4">
    <%= render partial: 'links' %>
    <%= render partial: 'rec_details', locals: { id: 'finnhub_rec', label: 'Finnhub Recommendation', mean: @stock.finnhub_rec, details: @stock.finnhub_rec_details } %>
    <%= render partial: 'rec_details', locals: { id: 'yahoo_rec', label: 'Yahoo Recommendation', mean: @stock.yahoo_rec, details: @stock.yahoo_rec_details } %>
    <%= render partial: 'tradingview_rec' %>
  </div>
</div>
